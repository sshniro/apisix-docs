(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{155:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return o})),n.d(t,"default",(function(){return p}));var a=n(2),i=n(9),r=(n(0),n(179)),l={id:"architecture",title:"Architecture",sidebar_label:"Architecture"},c={id:"architecture",title:"Architecture",description:"Plugin Loading Process",source:"@site/docs/architecture.md",permalink:"/apisix-docs/docs/architecture",editUrl:"https://github.com/apache/incubator-apisix/edit/master/website/docs/architecture.md",sidebar_label:"Architecture",sidebar:"docs",previous:{title:"Introduction",permalink:"/apisix-docs/docs/introduction"},next:{title:"Quick Start Guide",permalink:"/apisix-docs/docs/getting-started"}},o=[{value:"Plugin Loading Process",id:"plugin-loading-process",children:[]},{value:"Plugin Hierarchy Structure",id:"plugin-hierarchy-structure",children:[]},{value:"APISIX Config",id:"apisix-config",children:[]},{value:"Route",id:"route",children:[]},{value:"Service",id:"service",children:[]},{value:"Plugin",id:"plugin",children:[]},{value:"Upstream",id:"upstream",children:[{value:"Configuration",id:"configuration",children:[]}]},{value:"Router",id:"router",children:[]},{value:"Consumer",id:"consumer-1",children:[]},{value:"Debug mode",id:"debug-mode",children:[{value:"Basic Debug Mode",id:"basic-debug-mode",children:[]},{value:"Advanced Debug Mode",id:"advanced-debug-mode",children:[]}]}],b={rightToc:o};function p(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h3",{id:"plugin-loading-process"},"Plugin Loading Process"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"./assets/flow-load-plugin.png",alt:"flow-load-plugin"}))),Object(r.b)("h3",{id:"plugin-hierarchy-structure"},"Plugin Hierarchy Structure"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"assets/flow-plugin-internal.png",alt:"flow-plugin-internal"}))),Object(r.b)("h2",{id:"apisix-config"},"APISIX Config"),Object(r.b)("p",null,"We can start using APISIX just by modifying ",Object(r.b)("inlineCode",{parentName:"p"},"conf/config.yaml")," file."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'apisix:\n  node_listen: 9080             # APISIX listening port\n\netcd:\n  host: "http://127.0.0.1:2379" # etcd address\n  prefix: "apisix"              # apisix configurations prefix\n  timeout: 60\n\nplugins:                        # plugin name list\n  - example-plugin\n  - limit-req\n  - limit-count\n  - ...\n')),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"Note")," ",Object(r.b)("inlineCode",{parentName:"p"},"apisix")," will generate ",Object(r.b)("inlineCode",{parentName:"p"},"conf/nginx.conf")," file automatically, so please ",Object(r.b)("em",{parentName:"p"},"DO NOT EDIT")," that file."),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#Table-of-contents"}),"Back to top")),Object(r.b)("h2",{id:"route"},"Route"),Object(r.b)("p",null,"The route matches the client's request by defining rules, then loads and executes the corresponding plugin based on the matching result, and forwards the request to the specified Upstream."),Object(r.b)("p",null,"The route mainly consists of three parts: matching rules (e.g uri, host, remote_addr, etc.), plugin configuration (current-limit & rate-limit, etc.) and upstream information."),Object(r.b)("p",null,"The following image shows an example of some Route rules. When some attribute values are the same, the figure is identified by the same color."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"assets/routes-example.png",alt:"routes-example"}))),Object(r.b)("p",null,"We configure all the parameters directly in the Route, it's easy to set up, and each Route has a relatively high degree of freedom. But when our Route has more repetitive configurations (such as enabling the same plugin configuration or upstream information), once we need update these same properties, we have to traverse all the Routes and modify them, so it adding a lot of complexity of management and maintenance."),Object(r.b)("p",null,"The shortcomings mentioned above are independently abstracted in APISIX by the two concepts ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#service"}),"Service")," and ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#upstream"}),"Upstream"),"."),Object(r.b)("p",null,"The route example created below is to proxy the request with uri ",Object(r.b)("inlineCode",{parentName:"p"},"/index.html")," to the Upstream service with the address ",Object(r.b)("inlineCode",{parentName:"p"},"39.97.63.215:80"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'$ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\n{\n    "uri": "/index.html",\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "39.97.63.215:80": 1\n        }\n    }\n}\'\n\nHTTP/1.1 201 Created\nDate: Sat, 31 Aug 2019 01:17:15 GMT\nContent-Type: text/plain\nTransfer-Encoding: chunked\nConnection: keep-alive\nServer: APISIX web server\n\n{"node":{"value":{"uri":"\\/index.html","upstream":{"nodes":{"39.97.63.215:80":1},"type":"roundrobin"}},"createdIndex":61925,"key":"\\/apisix\\/routes\\/1","modifiedIndex":61925},"action":"create"}\n')),Object(r.b)("p",null,"When we receive a successful response, it indicates that the route was successfully created."),Object(r.b)("p",null,"For specific options of Route, please refer to ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"admin-api-cn.md#route"}),"Admin API"),"."),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#Table-of-contents"}),"Back to top")),Object(r.b)("h2",{id:"service"},"Service"),Object(r.b)("p",null,"A ",Object(r.b)("inlineCode",{parentName:"p"},"Service")," is an abstraction of an API (which can also be understood as a set of Route abstractions). It usually corresponds to the upstream service abstraction. Between ",Object(r.b)("inlineCode",{parentName:"p"},"Route")," and ",Object(r.b)("inlineCode",{parentName:"p"},"Service"),", usually the relationship of N:1, please see the following image."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"assets/service-example.png",alt:"service-example"}))),Object(r.b)("p",null,"Different Route rules are bound to a Service at the same time. These Routes will have the same upstream and plugin configuration, reducing redundant configuration."),Object(r.b)("p",null,"The following example creates a Service that enables the current-limit plugin, and then binds the Route with the id of ",Object(r.b)("inlineCode",{parentName:"p"},"100")," and ",Object(r.b)("inlineCode",{parentName:"p"},"101")," to the Service."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'# create new Service\n$ curl http://127.0.0.1:9080/apisix/admin/services/200 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "limit-count": {\n            "count": 2,\n            "time_window": 60,\n            "rejected_code": 503,\n            "key": "remote_addr"\n        }\n    },\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "39.97.63.215:80": 1\n        }\n    }\n}\'\n\n# create new Route and reference the service by id `200`\ncurl http://127.0.0.1:9080/apisix/admin/routes/100 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "methods": ["GET"],\n    "uri": "/index.html",\n    "service_id": "200"\n}\'\n\ncurl http://127.0.0.1:9080/apisix/admin/routes/101 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "methods": ["GET"],\n    "uri": "/foo/index.html",\n    "service_id": "200"\n}\'\n')),Object(r.b)("p",null,"Of course, we can also specify different plugin parameters or upstream for Route. Some of the following Routes have different current-limit parameters. Other parts (such as upstream) continue to use the configuration parameters in Service."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/apisix/admin/routes/102 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "uri": "/bar/index.html",\n    "id": "102",\n    "service_id": "200",\n    "plugins": {\n        "limit-count": {\n            "count": 2000,\n            "time_window": 60,\n            "rejected_code": 503,\n            "key": "remote_addr"\n        }\n    }\n}\'\n')),Object(r.b)("p",null,"Note: When both Route and Service enable the same plugin, the Route parameter has a higher priority than Service."),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#Table-of-contents"}),"Back to top")),Object(r.b)("h2",{id:"plugin"},"Plugin"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"Plugin")," represents the plugin configuration that will be executed during the ",Object(r.b)("inlineCode",{parentName:"p"},"HTTP")," request/response lifecycle."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"Plugin")," configuration can be bound directly to ",Object(r.b)("inlineCode",{parentName:"p"},"Route")," or it can be bound to ",Object(r.b)("inlineCode",{parentName:"p"},"Service")," or ",Object(r.b)("inlineCode",{parentName:"p"},"Consumer"),". For the configuration of the same plugin, only one copy is valid, and the configuration selection priority is always ",Object(r.b)("inlineCode",{parentName:"p"},"Consumer")," > ",Object(r.b)("inlineCode",{parentName:"p"},"Route")," > ",Object(r.b)("inlineCode",{parentName:"p"},"Service"),"."),Object(r.b)("p",null,"In ",Object(r.b)("inlineCode",{parentName:"p"},"conf/config.yaml"),", you can declare which plugins are supported by the local APISIX node. This is a whitelisting mechanism. Plugins that are not in this whitelist will be automatically ignored. This feature can be used to temporarily turn off or turn on specific plugins, which is very effective in dealing with unexpected situations."),Object(r.b)("p",null,"The configuration of the plugin can be directly bound to the specified Route, or it can be bound to the Service, but the plugin configuration in Route has a higher priority."),Object(r.b)("p",null,"A plugin will only be executed once in a single request, even if it is bound to multiple different objects (such as Route or Service)."),Object(r.b)("p",null,"The order in which plugins are run is determined by the priority of the plugin itself, for example: ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"../apisix/plugins/example-plugin.lua#L37"}),"example-plugin"),"."),Object(r.b)("p",null,"The plugin configuration is submitted as part of Route or Service and placed under ",Object(r.b)("inlineCode",{parentName:"p"},"plugins"),". It internally uses the plugin name as the hash's key to hold configuration items for different plugins."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n    ...\n    "plugins": {\n        "limit-count": {\n            "count": 2,\n            "time_window": 60,\n            "rejected_code": 503,\n            "key": "remote_addr"\n        },\n        "prometheus": {}\n    }\n}\n')),Object(r.b)("p",null,"Not all plugins have specific configuration items. For example, there is no specific configuration item under ",Object(r.b)("inlineCode",{parentName:"p"},"prometheus"),". In this case, an empty object identifier can be used."),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"README.md#plugins"}),"APISIX supported plugin list")),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#Table-of-contents"}),"Back to top")),Object(r.b)("h2",{id:"upstream"},"Upstream"),Object(r.b)("p",null,"Upstream is a virtual host abstraction that performs load balancing on a given set of service nodes according to configuration rules. Upstream address information can be directly configured to ",Object(r.b)("inlineCode",{parentName:"p"},"Route")," (or ",Object(r.b)("inlineCode",{parentName:"p"},"Service"),'). When Upstream has duplicates, you need to use "reference" to avoid duplication.'),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"assets/upstream-example.png",alt:"upstream-example"}))),Object(r.b)("p",null,"As shown in the image above, by creating an Upstream object and referencing it by ID in ",Object(r.b)("inlineCode",{parentName:"p"},"Route"),", you can ensure that only the value of an object is maintained."),Object(r.b)("p",null,"Upstream configuration can be directly bound to the specified ",Object(r.b)("inlineCode",{parentName:"p"},"Route")," or it can be bound to ",Object(r.b)("inlineCode",{parentName:"p"},"Service"),", but the configuration in ",Object(r.b)("inlineCode",{parentName:"p"},"Route")," has a higher priority. The priority behavior here is very similar to ",Object(r.b)("inlineCode",{parentName:"p"},"Plugin"),"."),Object(r.b)("h3",{id:"configuration"},"Configuration"),Object(r.b)("p",null,"In addition to the basic complex equalization algorithm selection, APISIX's Upstream also supports logic for upstream passive health check and retry, see the table below."),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Name"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Optional"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"type"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"roundrobin")," supports the weight of the load, ",Object(r.b)("inlineCode",{parentName:"td"},"chash")," consistency hash, pick one of them.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"nodes"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required if ",Object(r.b)("inlineCode",{parentName:"td"},"service_name")," and ",Object(r.b)("inlineCode",{parentName:"td"},"k8s_deployment_info")," not configured"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Hash table, the key of the internal element is the upstream machine address list, the format is ",Object(r.b)("inlineCode",{parentName:"td"},"Address + Port"),", where the address part can be IP or domain name, such as ",Object(r.b)("inlineCode",{parentName:"td"},"192.168.1.100:80"),", ",Object(r.b)("inlineCode",{parentName:"td"},"foo.com:80"),", etc. Value is the weight of the node. In particular, when the weight value is ",Object(r.b)("inlineCode",{parentName:"td"},"0"),", it has a special meaning, which usually means that the upstream node is invalid and never wants to be selected.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"service_name"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required if ",Object(r.b)("inlineCode",{parentName:"td"},"nodes")," and ",Object(r.b)("inlineCode",{parentName:"td"},"k8s_deployment_info")," not configured"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The name of the upstream service and used with the registry, refer to ",Object(r.b)("a",Object(a.a)({parentName:"td"},{href:"discovery.md"}),"Integration service discovery registry"),".")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"k8s_deployment_info"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required if ",Object(r.b)("inlineCode",{parentName:"td"},"nodes")," and ",Object(r.b)("inlineCode",{parentName:"td"},"service_name")," not configured"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"fields: ",Object(r.b)("inlineCode",{parentName:"td"},"namespace"),"\u3001",Object(r.b)("inlineCode",{parentName:"td"},"deploy_name"),"\u3001",Object(r.b)("inlineCode",{parentName:"td"},"service_name"),"\u3001",Object(r.b)("inlineCode",{parentName:"td"},"port"),"\u3001",Object(r.b)("inlineCode",{parentName:"td"},"backend_type"),", ",Object(r.b)("inlineCode",{parentName:"td"},"port")," is number, ",Object(r.b)("inlineCode",{parentName:"td"},"backend_type")," is ",Object(r.b)("inlineCode",{parentName:"td"},"pod")," or ",Object(r.b)("inlineCode",{parentName:"td"},"service"),", others is string.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"hash_on"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"optional"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"This option is only valid if the ",Object(r.b)("inlineCode",{parentName:"td"},"type")," is ",Object(r.b)("inlineCode",{parentName:"td"},"chash"),". Supported types ",Object(r.b)("inlineCode",{parentName:"td"},"vars"),"(Nginx variables), ",Object(r.b)("inlineCode",{parentName:"td"},"header"),"(custom header), ",Object(r.b)("inlineCode",{parentName:"td"},"cookie"),", ",Object(r.b)("inlineCode",{parentName:"td"},"consumer"),", the default value is ",Object(r.b)("inlineCode",{parentName:"td"},"vars"),".")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"key"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"This option is only valid if the ",Object(r.b)("inlineCode",{parentName:"td"},"type")," is ",Object(r.b)("inlineCode",{parentName:"td"},"chash"),". Find the corresponding node ",Object(r.b)("inlineCode",{parentName:"td"},"id")," according to ",Object(r.b)("inlineCode",{parentName:"td"},"hash_on")," and ",Object(r.b)("inlineCode",{parentName:"td"},"key"),". When ",Object(r.b)("inlineCode",{parentName:"td"},"hash_on")," is set as ",Object(r.b)("inlineCode",{parentName:"td"},"vars"),", ",Object(r.b)("inlineCode",{parentName:"td"},"key")," is the required parameter, for now, it support nginx built-in variables like ",Object(r.b)("inlineCode",{parentName:"td"},"uri, server_name, server_addr, request_uri, remote_port, remote_addr, query_string, host, hostname, arg_***"),", ",Object(r.b)("inlineCode",{parentName:"td"},"arg_***")," is arguments in the request line, ",Object(r.b)("a",Object(a.a)({parentName:"td"},{href:"http://nginx.org/en/docs/varindex.html"}),"Nginx variables list"),". When ",Object(r.b)("inlineCode",{parentName:"td"},"hash_on")," is set as ",Object(r.b)("inlineCode",{parentName:"td"},"header"),", ",Object(r.b)("inlineCode",{parentName:"td"},"key")," is the required parameter, and ",Object(r.b)("inlineCode",{parentName:"td"},"header name")," is customized. When ",Object(r.b)("inlineCode",{parentName:"td"},"hash_on")," is set to ",Object(r.b)("inlineCode",{parentName:"td"},"cookie"),", ",Object(r.b)("inlineCode",{parentName:"td"},"key")," is the required parameter, and ",Object(r.b)("inlineCode",{parentName:"td"},"cookie name")," is customized. When ",Object(r.b)("inlineCode",{parentName:"td"},"hash_on")," is set to ",Object(r.b)("inlineCode",{parentName:"td"},"consumer"),", ",Object(r.b)("inlineCode",{parentName:"td"},"key")," does not need to be set. In this case, the ",Object(r.b)("inlineCode",{parentName:"td"},"key")," adopted by the hash algorithm is the ",Object(r.b)("inlineCode",{parentName:"td"},"consumer_id")," authenticated. If the specified ",Object(r.b)("inlineCode",{parentName:"td"},"hash_on")," and ",Object(r.b)("inlineCode",{parentName:"td"},"key")," can not fetch values, it will be fetch ",Object(r.b)("inlineCode",{parentName:"td"},"remote_addr")," by default.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"checks"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"optional"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Configure the parameters of the health check. For details, refer to ",Object(r.b)("a",Object(a.a)({parentName:"td"},{href:"health-check.md"}),"health-check"),".")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"retries"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"optional"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Pass the request to the next upstream using the underlying Nginx retry mechanism, the retry mechanism is enabled by default and set the number of retries according to the number of backend nodes. If ",Object(r.b)("inlineCode",{parentName:"td"},"retries")," option is explicitly set, it will override the default value.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"enable_websocket"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"optional"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"enable ",Object(r.b)("inlineCode",{parentName:"td"},"websocket"),"(boolean), default ",Object(r.b)("inlineCode",{parentName:"td"},"false"),".")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"timeout"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"optional"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Set the timeout for connection, sending and receiving messages.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"desc"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"optional"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Identifies route names, usage scenarios, and more.")))),Object(r.b)("p",null,"Create an upstream object use case:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'curl http://127.0.0.1:9080/apisix/admin/upstreams/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "type": "roundrobin",\n    "k8s_deployment_info": {\n        "namespace": "test-namespace",\n        "deploy_name": "test-deploy-name",\n        "service_name": "test-service-name",\n        "backend_type": "pod",\n        "port": 8080\n    }\n}\'\n\ncurl http://127.0.0.1:9080/apisix/admin/upstreams/2 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "type": "chash",\n    "key": "remote_addr",\n    "enable_websocket": true,\n    "nodes": {\n        "127.0.0.1:80": 1,\n        "foo.com:80": 2\n    }\n}\'\n')),Object(r.b)("p",null,"After the upstream object is created, it can be referenced by specific ",Object(r.b)("inlineCode",{parentName:"p"},"Route")," or ",Object(r.b)("inlineCode",{parentName:"p"},"Service"),", for example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "uri": "/index.html",\n    "upstream_id": 2\n}\'\n')),Object(r.b)("p",null,"For convenience, you can also directly bind the upstream address to a ",Object(r.b)("inlineCode",{parentName:"p"},"Route")," or ",Object(r.b)("inlineCode",{parentName:"p"},"Service"),", for example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "uri": "/index.html",\n    "plugins": {\n        "limit-count": {\n            "count": 2,\n            "time_window": 60,\n            "rejected_code": 503,\n            "key": "remote_addr"\n        }\n    },\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "39.97.63.215:80": 1\n        }\n    }\n}\'\n')),Object(r.b)("p",null,"Here's an example of configuring a health check:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "uri": "/index.html",\n    "plugins": {\n        "limit-count": {\n            "count": 2,\n            "time_window": 60,\n            "rejected_code": 503,\n            "key": "remote_addr"\n        }\n    },\n    "upstream": {\n         "nodes": {\n            "39.97.63.215:80": 1\n        }\n        "type": "roundrobin",\n        "retries": 2,\n        "checks": {\n            "active": {\n                "http_path": "/status",\n                "host": "foo.com",\n                "healthy": {\n                    "interval": 2,\n                    "successes": 1\n                },\n                "unhealthy": {\n                    "interval": 1,\n                    "http_failures": 2\n                }\n            }\n        }\n    }\n}\'\n')),Object(r.b)("p",null,"More details can be found in ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"health-check.md"}),"Health Checking Documents"),"."),Object(r.b)("p",null,"Here are some examples of configurations using different ",Object(r.b)("inlineCode",{parentName:"p"},"hash_on")," types:"),Object(r.b)("h4",{id:"consumer"},"Consumer"),Object(r.b)("p",null,"Create a consumer object:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d `\n{\n    "username": "jack",\n    "plugins": {\n       "key-auth": {\n            "key": "auth-jack"\n        }\n    }\n}`\n')),Object(r.b)("p",null,"Create route object and enable ",Object(r.b)("inlineCode",{parentName:"p"},"key-auth")," plugin authentication:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "key-auth": {}\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1,\n            "127.0.0.1:1981": 1\n        },\n        "type": "chash",\n        "hash_on": "consumer"\n    },\n    "uri": "/server_port"\n}\'\n')),Object(r.b)("p",null,"Test request, the ",Object(r.b)("inlineCode",{parentName:"p"},"consumer_id")," after authentication is passed will be used as the hash value of the load balancing hash algorithm:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/server_port -H "apikey: auth-jack"\n')),Object(r.b)("h4",{id:"cookie"},"Cookie"),Object(r.b)("p",null,"Create route and upstream object, ",Object(r.b)("inlineCode",{parentName:"p"},"hash_on")," is ",Object(r.b)("inlineCode",{parentName:"p"},"cookie"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "uri": "/hash_on_cookie",\n    "upstream": {\n        "key": "sid",\n        "type ": "chash",\n        "hash_on ": "cookie",\n        "nodes ": {\n            "127.0.0.1:1980": 1,\n            "127.0.0.1:1981": 1\n        }\n    }\n}\'\n')),Object(r.b)("p",null,"The client requests with ",Object(r.b)("inlineCode",{parentName:"p"},"Cookie"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),' curl http://127.0.0.1:9080/hash_on_cookie -H "Cookie: sid=3c183a30cffcda1408daf1c61d47b274"\n')),Object(r.b)("h4",{id:"header"},"Header"),Object(r.b)("p",null,"Create route and upstream object, ",Object(r.b)("inlineCode",{parentName:"p"},"hash_on")," is ",Object(r.b)("inlineCode",{parentName:"p"},"header"),", ",Object(r.b)("inlineCode",{parentName:"p"},"key")," is ",Object(r.b)("inlineCode",{parentName:"p"},"Content-Type"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "uri": "/hash_on_header",\n    "upstream": {\n        "key": "content-type",\n        "type ": "chash",\n        "hash_on ": "header",\n        "nodes ": {\n            "127.0.0.1:1980": 1,\n            "127.0.0.1:1981": 1\n        }\n    }\n}\'\n')),Object(r.b)("p",null,"The client requests with header ",Object(r.b)("inlineCode",{parentName:"p"},"Content-Type"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"})," curl http://127.0.0.1:9080/hash_on_header -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -H \"Content-Type: application/json\"\n")),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#Table-of-contents"}),"Back to top")),Object(r.b)("h2",{id:"router"},"Router"),Object(r.b)("p",null,"A distinguishing feature of APISIX from other API gateways is that it allows users to choose different routers to better match free services, making the best choice between performance and freedom."),Object(r.b)("p",null,"Set the route that best suits your business needs in the local configuration ",Object(r.b)("inlineCode",{parentName:"p"},"conf/config.yaml"),"."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"apisix.router.http"),": HTTP Request Route\u3002"),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"radixtree_uri"),": (Default) only use ",Object(r.b)("inlineCode",{parentName:"li"},"uri")," as the primary index. Support for full and deep prefix matching based on the ",Object(r.b)("inlineCode",{parentName:"li"},"radixtree")," engine, see ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"router-radixtree.md"}),"How to use router-radixtree"),".",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Absolute match "),": Complete match for the given ",Object(r.b)("inlineCode",{parentName:"li"},"uri")," , such as ",Object(r.b)("inlineCode",{parentName:"li"},"/foo/bar"),",",Object(r.b)("inlineCode",{parentName:"li"},"/foo/glo"),"."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Prefix match"),": Use ",Object(r.b)("inlineCode",{parentName:"li"},"*")," at the end to represent the given ",Object(r.b)("inlineCode",{parentName:"li"},"uri")," as a prefix match. For example, ",Object(r.b)("inlineCode",{parentName:"li"},"/foo*")," allows matching ",Object(r.b)("inlineCode",{parentName:"li"},"/foo/"),", ",Object(r.b)("inlineCode",{parentName:"li"},"/foo/a")," and ",Object(r.b)("inlineCode",{parentName:"li"},"/foo/b"),"."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"match priority"),": first try absolute match, if you can't hit absolute match, try prefix match."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Any filter attribute"),": Allows you to specify any Ningx built-in variable as a filter, such as uri request parameters, request headers, cookies, and so on."))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"radixtree_host_uri"),": Use ",Object(r.b)("inlineCode",{parentName:"li"},"host + uri")," as the primary index (based on the ",Object(r.b)("inlineCode",{parentName:"li"},"radixtree")," engine), matching both host and uri for the current request."))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"apisix.router.ssl"),": SSL loads the matching route."),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"radixtree_sni"),": (Default) Use ",Object(r.b)("inlineCode",{parentName:"li"},"SNI")," (Server Name Indication) as the primary index (based on the radixtree engine).")))),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#Table-of-contents"}),"Back to top")),Object(r.b)("h2",{id:"consumer-1"},"Consumer"),Object(r.b)("p",null,"For the API gateway, it is usually possible to identify a certain type of requester by using a domain name such as a request domain name, a client IP address, etc., and then perform plugin filtering and forward the request to the specified upstream, but sometimes the depth is insufficient."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"assets/consumer-who.png",alt:"consumer-who"}))),Object(r.b)("p",null,"As shown in the image above, as an API gateway, you should know who the API Consumer is, so you can configure different rules for different API Consumers."),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Field"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Required"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"username"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Yes"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Consumer Name.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"plugins"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"No"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The corresponding plugin configuration of the Consumer, which has the highest priority: Consumer > Route > Service. For specific plugin configurations, refer to the ",Object(r.b)("a",Object(a.a)({parentName:"td"},{href:"#plugin"}),"Plugins")," section.")))),Object(r.b)("p",null,"In APISIX, the process of identifying a Consumer is as follows:"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"assets/consumer-internal.png",alt:"consumer-internal"}))),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Authorization certification: e.g ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"./plugins/key-auth.md"}),"key-auth"),", ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"./plugins/jwt-auth.md"}),"JWT"),", etc."),Object(r.b)("li",{parentName:"ol"},"Get consumer_id: By authorization, you can naturally get the corresponding Consumer ",Object(r.b)("inlineCode",{parentName:"li"},"id"),", which is the unique identifier of the Consumer object."),Object(r.b)("li",{parentName:"ol"},"Get the Plugin or Upstream information bound to the Consumer: Complete the different configurations for different Consumers.")),Object(r.b)("p",null,"To sum up, Consumer is a consumer of certain types of services and needs to be used in conjunction with the user authentication system."),Object(r.b)("p",null,"For example, different consumers request the same API, and the gateway service corresponds to different Plugin or Upstream configurations according to the current request user information."),Object(r.b)("p",null,"In addition, you can refer to the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"./plugins/key-auth.md"}),"key-auth")," authentication authorization plugin call logic to help you further understand the Consumer concept and usage."),Object(r.b)("p",null,"How to enable a specific plugin for a Consumer, you can see the following example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'# Create a Consumer , specify the authentication plugin key-auth, and enable the specific plugin limit-count\n$ curl http://127.0.0.1:9080/apisix/admin/consumers/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "username": "jack",\n    "plugins": {\n        "key-auth": {\n            "key": "auth-one"\n        },\n        "limit-count": {\n            "count": 2,\n            "time_window": 60,\n            "rejected_code": 503,\n            "key": "remote_addr"\n        }\n    }\n}\'\n\n# Create a Router, set routing rules and enable plugin configuration\n$ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins": {\n        "key-auth": {}\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1\n        },\n        "type": "roundrobin"\n    },\n    "uri": "/hello"\n}\'\n\n# Send a test request, the first two return to normal, did not reach the speed limit threshold\n$ curl http://127.0.0.1:9080/hello -H \'apikey: auth-one\' -I\n...\n\n$ curl http://127.0.0.1:9080/hello -H \'apikey: auth-one\' -I\n...\n\n# The third test returns 503 and the request is restricted\n$ curl http://127.0.0.1:9080/hello -H \'apikey: auth-one\' -I\nHTTP/1.1 503 Service Temporarily Unavailable\n...\n\n')),Object(r.b)("p",null,"Use the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"./plugins/consumer-restriction-cn.md"}),"consumer-restriction")," plug-in to restrict the access of Jack to this API."),Object(r.b)("h1",{id:"add-jack-to-the-blacklist"},"Add Jack to the blacklist"),Object(r.b)("p",null,"$ curl ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"http://127.0.0.1:9080/apisix/admin/routes/1"}),"http://127.0.0.1:9080/apisix/admin/routes/1"),' -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n"plugins": {\n"key-auth": {},\n"consumer-restriction": {\n"blacklist": ','[\n"jack"\n]','\n}\n},\n"upstream": {\n"nodes": {\n"127.0.0.1:1980": 1\n},\n"type": "roundrobin"\n},\n"uri": "/hello"\n}\''),Object(r.b)("h1",{id:"repeated-tests-all-return-403-jack-is-forbidden-to-access-this-api"},"Repeated tests, all return 403; Jack is forbidden to access this API"),Object(r.b)("p",null,"$ curl ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"http://127.0.0.1:9080/hello"}),"http://127.0.0.1:9080/hello")," -H 'apikey: auth-one' -I\nHTTP/1.1 403\n..."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'\n[Back to top](#Table-of-contents)\n\n## Global Rule\n\n[Plugin](#Plugin) just can be binded to [Service](#Service) or [Route](#Route), if we want a [Plugin](#Plugin) work on all requests, how to do it?\nWe can register a global [Plugin](#Plugin) with `GlobalRule`:\n\n```shell\ncurl -X PUT \\\n  https://{apisix_listen_address}/apisix/admin/global_rules/1 \\\n  -H \'Content-Type: application/json\' \\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\n  -d \'{\n        "plugins": {\n            "limit-count": {\n                "time_window": 60,\n                "policy": "local",\n                "count": 2,\n                "key": "remote_addr",\n                "rejected_code": 503\n            }\n        }\n    }\'\n')),Object(r.b)("p",null,"Now, the ",Object(r.b)("inlineCode",{parentName:"p"},"limit-count")," plugin will work on all requets"),Object(r.b)("p",null,"we can list all ",Object(r.b)("inlineCode",{parentName:"p"},"GlobalRule")," via admin api as below:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"curl https://{apisix_listen_address}/apisix/admin/global_rules\n")),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#Table-of-contents"}),"Back to top")),Object(r.b)("h2",{id:"debug-mode"},"Debug mode"),Object(r.b)("h3",{id:"basic-debug-mode"},"Basic Debug Mode"),Object(r.b)("p",null,"Enable basic debug mode just by setting ",Object(r.b)("inlineCode",{parentName:"p"},"apisix.enable_debug = true")," in ",Object(r.b)("inlineCode",{parentName:"p"},"conf/config.yaml")," file."),Object(r.b)("p",null,"e.g Using both ",Object(r.b)("inlineCode",{parentName:"p"},"limit-conn")," and ",Object(r.b)("inlineCode",{parentName:"p"},"limit-count")," plugins for a ",Object(r.b)("inlineCode",{parentName:"p"},"/hello")," request, there will have a response header called ",Object(r.b)("inlineCode",{parentName:"p"},"Apisix-Plugins: limit-conn, limit-count"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"$ curl http://127.0.0.1:1984/hello -i\nHTTP/1.1 200 OK\nContent-Type: text/plain\nTransfer-Encoding: chunked\nConnection: keep-alive\nApisix-Plugins: limit-conn, limit-count\nX-RateLimit-Limit: 2\nX-RateLimit-Remaining: 1\nServer: openresty\n\nhello world\n")),Object(r.b)("h3",{id:"advanced-debug-mode"},"Advanced Debug Mode"),Object(r.b)("p",null,"Enable advanced debug mode by modifying the configuration in ",Object(r.b)("inlineCode",{parentName:"p"},"conf/debug.yaml")," file. Because there will have a check every second, only the checker reads the ",Object(r.b)("inlineCode",{parentName:"p"},"#END")," flag, and the file would consider as closed."),Object(r.b)("p",null,"The checker would judge whether the file data changed according to the last modification time of the file. If there has any change, reload it. If there was no change, skip this check. So it's hot reload for enabling or disabling advanced debug mode."),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Key"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Optional"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Default"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"hook_conf.enable"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Enable/Disable hook debug trace. Target module function's input arguments or returned value would be printed once this option is enabled."),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"false")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"hook_conf.name"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The module list name of hook which has enabled debug trace"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"hook_conf.log_level"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Logging levels for input arguments & returned value"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"warn")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"hook_conf.is_print_input_args"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Enable/Disable input arguments print"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"true")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"hook_conf.is_print_return_value"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"required"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Enable/Disable returned value print"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"true")))),Object(r.b)("p",null,"Example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"hook_conf:\n  enable: false                 # Enable/Disable Hook Debug Trace\n  name: hook_phase              # The Module List Name of Hook which has enabled Debug Trace\n  log_level: warn               # Logging Levels\n  is_print_input_args: true     # Enable/Disable Input Arguments Print\n  is_print_return_value: true   # Enable/Disable Returned Value Print\n\nhook_phase:                     # Module Function List, Name: hook_phase\n  apisix:                       # Referenced Module Name\n    - http_access_phase         # Function Names\uff1aArray\n    - http_header_filter_phase\n    - http_body_filter_phase\n    - http_log_phase\n\n#END\n")),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#Table-of-contents"}),"Back to top")))}p.isMDXComponent=!0},179:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var b=i.a.createContext({}),p=function(e){var t=i.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},s=function(e){var t=p(e.components);return i.a.createElement(b.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},u=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,b=o(e,["components","mdxType","originalType","parentName"]),s=p(n),u=a,m=s["".concat(l,".").concat(u)]||s[u]||d[u]||r;return n?i.a.createElement(m,c(c({ref:t},b),{},{components:n})):i.a.createElement(m,c({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=u;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=e,c.mdxType="string"==typeof e?e:a,l[1]=c;for(var b=2;b<r;b++)l[b]=n[b];return i.a.createElement.apply(null,l)}return i.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);