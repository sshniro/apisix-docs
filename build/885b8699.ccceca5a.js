(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{126:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return l})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return i})),a.d(t,"default",(function(){return O}));var n=a(2),r=a(6),b=(a(0),a(145)),l={},c={id:"plugins/en/batch-requests",title:"batch-requests",description:"\x3c!--",source:"@site/docs/plugins/en/batch-requests.md",permalink:"/docs/plugins/en/batch-requests",editUrl:"https://github.com/apache/incubator-apisix/edit/master/website/docs/plugins/en/batch-requests.md"},i=[{value:"Description",id:"description",children:[]},{value:"Attributes",id:"attributes",children:[]},{value:"How To Enable",id:"how-to-enable",children:[]},{value:"Batch Api Request/Response",id:"batch-api-requestresponse",children:[{value:"Batch Api Request:",id:"batch-api-request",children:[]},{value:"Batch Api Response\uff1a",id:"batch-api-response\uff1a",children:[]}]},{value:"Test Plugin",id:"test-plugin",children:[]},{value:"Disable Plugin",id:"disable-plugin",children:[]}],p={rightToc:i};function O(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(b.b)("wrapper",Object(n.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(b.b)("h2",{id:"description"},"Description"),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"batch-requests")," can accept mutiple request and send them from ",Object(b.b)("inlineCode",{parentName:"p"},"apisix")," via ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/HTTP_pipelining"}),"http pipeline"),",and return a aggregated response to client,this can significantly improve performance when the client needs to access multiple APIs."),Object(b.b)("h2",{id:"attributes"},"Attributes"),Object(b.b)("p",null,"None"),Object(b.b)("h2",{id:"how-to-enable"},"How To Enable"),Object(b.b)("p",null,"Default enbaled"),Object(b.b)("h2",{id:"batch-api-requestresponse"},"Batch Api Request/Response"),Object(b.b)("p",null,"The plugin will create a api in ",Object(b.b)("inlineCode",{parentName:"p"},"apisix")," to handle your aggregation request."),Object(b.b)("h3",{id:"batch-api-request"},"Batch Api Request:"),Object(b.b)("table",null,Object(b.b)("thead",{parentName:"table"},Object(b.b)("tr",{parentName:"thead"},Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"ParameterName"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Type"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Optional"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Default"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(b.b)("tbody",{parentName:"table"},Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"query"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Object"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Specify ",Object(b.b)("inlineCode",{parentName:"td"},"QueryString")," for all request")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"headers"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Object"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Specify ",Object(b.b)("inlineCode",{parentName:"td"},"Header")," for all request")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"timeout"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Number"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"3000"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Aggregate Api timeout in ",Object(b.b)("inlineCode",{parentName:"td"},"ms"))),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"pipeline"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("a",Object(n.a)({parentName:"td"},{href:"#Request"}),"HttpRequest")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"No"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Request's detail")))),Object(b.b)("h4",{id:"httprequest"},"HttpRequest"),Object(b.b)("table",null,Object(b.b)("thead",{parentName:"table"},Object(b.b)("tr",{parentName:"thead"},Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"ParameterName"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Type"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Optional"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Default"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(b.b)("tbody",{parentName:"table"},Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"version"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Enum"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"1.1"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"http version: ",Object(b.b)("inlineCode",{parentName:"td"},"1.0")," or ",Object(b.b)("inlineCode",{parentName:"td"},"1.1"))),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"method"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Enum"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"GET"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"http method, such as\uff1a",Object(b.b)("inlineCode",{parentName:"td"},"GET"),".")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"query"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Object"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"request's ",Object(b.b)("inlineCode",{parentName:"td"},"QueryString"),", if ",Object(b.b)("inlineCode",{parentName:"td"},"Key")," is conflicted with global ",Object(b.b)("inlineCode",{parentName:"td"},"query"),", this setting's value will be setted.")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"headers"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Object"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"request's ",Object(b.b)("inlineCode",{parentName:"td"},"Header"),", if ",Object(b.b)("inlineCode",{parentName:"td"},"Key")," is conflicted with global ",Object(b.b)("inlineCode",{parentName:"td"},"headers"),", this setting's value will be setted.")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"path"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"String"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"No"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"http request's path")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"body"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"String"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"http request's body")))),Object(b.b)("h3",{id:"batch-api-response\uff1a"},"Batch Api Response\uff1a"),Object(b.b)("p",null,"Response is ",Object(b.b)("inlineCode",{parentName:"p"},"Array")," of ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"#HttpResponse"}),"HttpResponse"),"."),Object(b.b)("h4",{id:"httpresponse"},"HttpResponse"),Object(b.b)("table",null,Object(b.b)("thead",{parentName:"table"},Object(b.b)("tr",{parentName:"thead"},Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"ParameterName"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Type"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(b.b)("tbody",{parentName:"table"},Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"status"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Integer"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"http status code")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"reason"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"String"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"http reason phrase")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"body"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"String"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"http response body")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"headers"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Object"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"http response headers")))),Object(b.b)("h2",{id:"test-plugin"},"Test Plugin"),Object(b.b)("p",null,"You can pass your request detail to batch api( ",Object(b.b)("inlineCode",{parentName:"p"},"/apisix/batch-requests")," ), ",Object(b.b)("inlineCode",{parentName:"p"},"apisix")," can automatically complete requests via ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/HTTP_pipelining"}),"http pipeline"),". Such as:"),Object(b.b)("pre",null,Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'curl --location --request POST \'http://127.0.0.1:9080/apisix/batch-requests\' \\\n--header \'Content-Type: application/json\' \\\n--d \'{\n    "headers": {\n        "Content-Type": "application/json",\n        "admin-jwt":"xxxx"\n    },\n    "timeout": 500,\n    "pipeline": [\n        {\n            "method": "POST",\n            "path": "/community.GiftSrv/GetGifts",\n            "body": "test"\n        },\n        {\n            "method": "POST",\n            "path": "/community.GiftSrv/GetGifts",\n            "body": "test2"\n        }\n    ]\n}\'\n')),Object(b.b)("p",null,"response as below\uff1a"),Object(b.b)("pre",null,Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'[\n    {\n        "status": 200,\n        "reason": "OK",\n        "body": "{\\"ret\\":500,\\"msg\\":\\"error\\",\\"game_info\\":null,\\"gift\\":[],\\"to_gets\\":0,\\"get_all_msg\\":\\"\\"}",\n        "headers": {\n            "Connection": "keep-alive",\n            "Date": "Sat, 11 Apr 2020 17:53:20 GMT",\n            "Content-Type": "application/json",\n            "Content-Length": "81",\n            "Server": "APISIX web server"\n        }\n    },\n    {\n        "status": 200,\n        "reason": "OK",\n        "body": "{\\"ret\\":500,\\"msg\\":\\"error\\",\\"game_info\\":null,\\"gift\\":[],\\"to_gets\\":0,\\"get_all_msg\\":\\"\\"}",\n        "headers": {\n            "Connection": "keep-alive",\n            "Date": "Sat, 11 Apr 2020 17:53:20 GMT",\n            "Content-Type": "application/json",\n            "Content-Length": "81",\n            "Server": "APISIX web server"\n        }\n    }\n]\n')),Object(b.b)("h2",{id:"disable-plugin"},"Disable Plugin"),Object(b.b)("p",null,"Normally, you don't need to disable this plugin.If you does need please remove it from the ",Object(b.b)("inlineCode",{parentName:"p"},"plugins")," section of",Object(b.b)("inlineCode",{parentName:"p"},"/conf/config.yaml"),"."))}O.isMDXComponent=!0},145:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return s}));var n=a(0),r=a.n(n);function b(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){b(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},b=Object.keys(e);for(n=0;n<b.length;n++)a=b[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(n=0;n<b.length;n++)a=b[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=r.a.createContext({}),O=function(e){var t=r.a.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},o=function(e){var t=O(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},j={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,b=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),o=O(a),u=n,s=o["".concat(l,".").concat(u)]||o[u]||j[u]||b;return a?r.a.createElement(s,c(c({ref:t},p),{},{components:a})):r.a.createElement(s,c({ref:t},p))}));function s(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var b=a.length,l=new Array(b);l[0]=u;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:n,l[1]=c;for(var p=2;p<b;p++)l[p]=a[p];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);